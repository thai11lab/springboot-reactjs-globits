{"ast":null,"code":"import axios from \"axios\";\nimport localStorageService from \"./localStorageService\";\nimport ConstantList from \"../appConfig\";\nimport UserService from \"../services/UserService\";\nconst config = {\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n    'Authorization': 'Basic Y29yZV9jbGllbnQ6c2VjcmV0'\n  }\n};\n\nclass JwtAuthService {\n  constructor() {\n    this.user = {\n      userId: \"1\",\n      role: 'ADMIN',\n      displayName: \"Watson Joyce\",\n      email: \"watsonjoyce@gmail.com\",\n      photoURL: ConstantList.ROOT_PATH + \"assets/images/face-7.jpg\",\n      age: 25,\n      token: \"faslkhfh423oiu4h4kj432rkj23h432u49ufjaklj423h4jkhkjh\"\n    };\n\n    this.loginWithUserNameAndPassword = (username, password) => {\n      let requestBody = 'client_id=core_client&grant_type=password&client_secret=secret';\n      requestBody = requestBody + '&username=' + username + '&password=' + password;\n      return axios.post(ConstantList.API_ENPOINT + '/oauth/token', requestBody, config).then(response => {\n        //this.setUser(data);\n        console.log(response); //alert(response.data.access_token);\n\n        this.setSession(response.data.access_token);\n        this.setLoginUser(response.data);\n      });\n    };\n\n    this.loadPageWithToken = () => {\n      return axios.post(ConstantList.API_ENPOINT + 'oauth/token').then(res => {\n        this.setSession(res.data.access_token);\n        this.setLoginToken(res.data);\n      });\n    };\n\n    this.loginWithEmailAndPassword = (email, password) => {\n      return new Promise((resolve, reject) => {\n        setTimeout(() => {\n          resolve(this.user);\n        }, 1000);\n      }).then(data => {\n        //console.log(data);\n        this.setUser(data);\n        this.setSession(data.token);\n        return data;\n      });\n    };\n\n    this.loginWithToken = () => {\n      return new Promise((resolve, reject) => {\n        setTimeout(() => {\n          resolve(this.user);\n        }, 100);\n      }).then(data => {\n        this.setSession(data.token);\n        this.setUser(data);\n        return data;\n      });\n    };\n\n    this.logout = () => {\n      if (ConstantList.AUTH_MODE == \"Keycloak\") {\n        UserService.doLogout();\n      }\n\n      this.setSession(null);\n      this.removeUser();\n    };\n\n    this.setSession = token => {\n      //alert('setSession');\n      if (token) {\n        localStorage.setItem(\"jwt_token\", token);\n        axios.defaults.headers.common[\"Authorization\"] = \"Bearer \" + token;\n      } else {\n        localStorage.removeItem(\"jwt_token\");\n        delete axios.defaults.headers.common[\"Authorization\"];\n      }\n    };\n\n    this.setLoginUser = data => {\n      let user = {};\n      user.token = data.access_token;\n      user.role = \"ADMIN\";\n      user.age = 25;\n      user.displayName = \"Watson Joyce\";\n      user.photoURL = ConstantList.ROOT_PATH + \"assets/images/face-7.jpg\";\n      this.user = user;\n      localStorageService.setItem(\"auth_user\", user);\n      return user;\n    };\n\n    this.setLoginToken = data => {\n      let user = {};\n      user.token = data;\n      user.role = \"ADMIN\";\n      user.age = 25;\n      user.displayName = \"Watson Joyce\";\n      user.photoURL = ConstantList.ROOT_PATH + \"assets/images/face-7.jpg\";\n      this.user = user;\n      localStorageService.setItem(\"auth_user\", user);\n      return user;\n    };\n\n    this.setUser = user => {\n      localStorageService.setItem(\"auth_user\", user);\n    };\n\n    this.removeUser = () => {\n      localStorage.removeItem(\"auth_user\");\n    };\n  }\n\n}\n\nexport default new JwtAuthService();","map":{"version":3,"sources":["D:/TraniningGlobits/baitap_level2/client/react/src/app/services/jwtAuthService.js"],"names":["axios","localStorageService","ConstantList","UserService","config","headers","JwtAuthService","user","userId","role","displayName","email","photoURL","ROOT_PATH","age","token","loginWithUserNameAndPassword","username","password","requestBody","post","API_ENPOINT","then","response","console","log","setSession","data","access_token","setLoginUser","loadPageWithToken","res","setLoginToken","loginWithEmailAndPassword","Promise","resolve","reject","setTimeout","setUser","loginWithToken","logout","AUTH_MODE","doLogout","removeUser","localStorage","setItem","defaults","common","removeItem"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport localStorageService from \"./localStorageService\";\nimport ConstantList from \"../appConfig\";\nimport UserService from \"../services/UserService\";\nconst config = {\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n    'Authorization':'Basic Y29yZV9jbGllbnQ6c2VjcmV0'\n  }\n}\nclass JwtAuthService {\n\n\n  user = {\n    userId: \"1\",\n    role: 'ADMIN',\n    displayName: \"Watson Joyce\",\n    email: \"watsonjoyce@gmail.com\",\n    photoURL:  ConstantList.ROOT_PATH+\"assets/images/face-7.jpg\",\n    age: 25,\n    token: \"faslkhfh423oiu4h4kj432rkj23h432u49ufjaklj423h4jkhkjh\"\n  }\n  loginWithUserNameAndPassword = (username, password) => {\n    let requestBody ='client_id=core_client&grant_type=password&client_secret=secret';\n    requestBody =requestBody+'&username='+username +'&password='+password;\n    return axios.post(ConstantList.API_ENPOINT+'/oauth/token',requestBody,config).then(response=>{\n      //this.setUser(data);\n      console.log(response);\n      //alert(response.data.access_token);\n      this.setSession(response.data.access_token);\n      this.setLoginUser(response.data);\n    });\n  };\n\n  //test\n  loadPageWithToken=()=>{\n    return axios.post(ConstantList.API_ENPOINT+'oauth/token').then(res=>{\n      this.setSession(res.data.access_token);\n      this.setLoginToken(res.data);\n    })\n  }\n  loginWithEmailAndPassword = (email, password) => {\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        resolve(this.user);\n      }, 1000);\n    }).then(data => {\n      //console.log(data);\n      this.setUser(data);\n      this.setSession(data.token);      \n      return data;\n    });\n  };\n\n  loginWithToken = () => {\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        resolve(this.user);\n      }, 100);\n    }).then(data => {\n      this.setSession(data.token);\n      this.setUser(data);\n      return data;\n    });\n  };\n\n  \n\n  logout = () => {\n    if(ConstantList.AUTH_MODE==\"Keycloak\"){\n      UserService.doLogout();\n    }    \n    this.setSession(null);\n    this.removeUser();\n  }\n  \n  \n  setSession = token => {\n    //alert('setSession');\n    if (token) {\n      localStorage.setItem(\"jwt_token\", token);\n      axios.defaults.headers.common[\"Authorization\"] = \"Bearer \" + token;\n    } else {\n      localStorage.removeItem(\"jwt_token\");\n      delete axios.defaults.headers.common[\"Authorization\"];\n    }\n  };\n  setLoginUser = (data) => {   \n    let user ={};\n    user.token = data.access_token; \n    user.role=\"ADMIN\";\n    user.age=25;\n    user.displayName =\"Watson Joyce\";\n    user.photoURL =ConstantList.ROOT_PATH+\"assets/images/face-7.jpg\";\n    this.user = user;\n    localStorageService.setItem(\"auth_user\", user);\n    return user;\n  }\n\n  setLoginToken = (data) => {   \n    let user ={};\n    user.token = data; \n    user.role=\"ADMIN\";\n    user.age=25;\n    user.displayName =\"Watson Joyce\";\n    user.photoURL =ConstantList.ROOT_PATH+\"assets/images/face-7.jpg\";\n    this.user = user;\n    localStorageService.setItem(\"auth_user\", user);\n    return user;\n  }\n\n  setUser = (user) => {    \n    localStorageService.setItem(\"auth_user\", user);\n  }\n  removeUser = () => {\n    localStorage.removeItem(\"auth_user\");\n  }\n}\n\nexport default new JwtAuthService();\n"]},"metadata":{},"sourceType":"module"}